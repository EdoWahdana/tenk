import { NEAR, Gas } from "near-units";
import { readFile } from "fs/promises";
import { Context } from "near-cli/context";
import * as tenk from "..";
import { binPath } from "./utils";

const icon =
  "data:image/png;base64,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";

const metadata: tenk.InitialMetadata = {
  uri: "https://bafybeiduuiztwwrphs4t7q5bl4xoidbemnbzkps2kzioflk2msacaw7yiu.ipfs.dweb.link",
  name: "Bullish Bulls",
  symbol: "thebullishbulls",
  icon,
};

const price_structure: tenk.PriceStructure = {
  base_cost: NEAR.parse("5 N").toJSON(),
};

const size = 2500;

const sale: tenk.Sale = {
  initial_royalties: {
    percent: 10_000,
    accounts: {
      "tenk.sputnik-dao.near": 2500,
      "bullishbullsdao.sputnik-dao.near": 500,
      "bb5397.near": 3750,
      "127ecf86ae1b26623506221e75d7b593f02dfccd8fc4d304c882c25e34f9d197": 3750,
    },
  },
  royalties: {
    percent: 500,
    accounts: {
      "tenk.sputnik-dao.near": 1000,
      "bullishbullsdao.sputnik-dao.near": 1000,
      "dwbb5.near": 500,
      "556xxt21.near": 3750,
      "azxz12g.near": 3750,
    },
  },
};

export async function main({ account, nearAPI, argv, near }: Context) {
  let { Account } = nearAPI;
  const contractBytes = await readFile(binPath("tenk"));

  let [contractId] = argv ?? [];
  contractId = contractId ?? account.accountId;
  let contractAccount = new Account(near.connection, contractId);

  const isTestnet = contractId.endsWith("testnet");
  if (isTestnet) {
    sale.initial_royalties = null;
  }

  const initialArgs = {
    owner_id: account.accountId,
    metadata,
    size,
    sale,
    price_structure,
  };

  const contract = new tenk.Contract(account, contractId);

  const tx = account
    .createTransaction(contractId)
    .deployContract(contractBytes);

  if (await contractAccount.hasDeployedContract()) {
    console.log(`initializing with: \n${JSON.stringify(initialArgs, null, 2)}`);
    tx.actions.push(
      contract.new_default_metaTx(initialArgs, { gas: Gas.parse("50Tgas") })
    );
  }
  let res = await tx.signAndSend();
  console.log(
    `https://explorer${isTestnet ? ".testnet" : ""}.near.org/transactions/${
      res.transaction_outcome.id
    }`
  );
  //@ts-ignore
  if (res.status.SuccessValue != undefined) {
    console.log(`deployed ${contractId}`);
  } else {
    console.log(res);
  }
}
